"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[5977],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>c});var n=a(67294);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var d=n.createContext({}),s=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=s(e.components);return n.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,l=e.mdxType,r=e.originalType,d=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),h=s(a),c=l,m=h["".concat(d,".").concat(c)]||h[c]||p[c]||r;return a?n.createElement(m,o(o({ref:t},u),{},{components:a})):n.createElement(m,o({ref:t},u))}));function c(e,t){var a=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=a.length,o=new Array(r);o[0]=h;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var s=2;s<r;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},52945:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>s});var n=a(83117),l=(a(67294),a(3905));const r={title:"Removing Metadata from DataHub",slug:"/how/delete-metadata",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/delete-metadata.md"},o="Removing Metadata from DataHub",i={unversionedId:"docs/how/delete-metadata",id:"docs/how/delete-metadata",title:"Removing Metadata from DataHub",description:"There are a two ways to delete metadata from DataHub:",source:"@site/genDocs/docs/how/delete-metadata.md",sourceDirName:"docs/how",slug:"/how/delete-metadata",permalink:"/datahub-project-forked/docs/how/delete-metadata",draft:!1,editUrl:"https://github.com/datahub-project/datahub/blob/master/docs/how/delete-metadata.md",tags:[],version:"current",frontMatter:{title:"Removing Metadata from DataHub",slug:"/how/delete-metadata",custom_edit_url:"https://github.com/datahub-project/datahub/blob/master/docs/how/delete-metadata.md"},sidebar:"overviewSidebar",previous:{title:"Authorization using Groups",permalink:"/datahub-project-forked/docs/authorization/groups"},next:{title:"Configuring Authorization with Apache Ranger",permalink:"/datahub-project-forked/docs/how/configuring-authorization-with-apache-ranger"}},d={},s=[{value:"Delete By Urn",id:"delete-by-urn",level:2},{value:"Soft Delete (the default)",id:"soft-delete-the-default",level:3},{value:"Hard Delete",id:"hard-delete",level:3},{value:"Delete by filters",id:"delete-by-filters",level:2},{value:"Delete all Datasets from the Snowflake platform",id:"delete-all-datasets-from-the-snowflake-platform",level:3},{value:"Delete all containers for a particular platform",id:"delete-all-containers-for-a-particular-platform",level:3},{value:"Delete all datasets in the DEV environment",id:"delete-all-datasets-in-the-dev-environment",level:3},{value:"Delete all Pipelines and Tasks in the DEV environment",id:"delete-all-pipelines-and-tasks-in-the-dev-environment",level:3},{value:"Delete all bigquery datasets in the PROD environment",id:"delete-all-bigquery-datasets-in-the-prod-environment",level:3},{value:"Delete all looker dashboards and charts",id:"delete-all-looker-dashboards-and-charts",level:3},{value:"Delete all datasets that match a query",id:"delete-all-datasets-that-match-a-query",level:3},{value:"Rollback Ingestion Run",id:"rollback-ingestion-run",level:2},{value:"Unsafe Entities and Rollback",id:"unsafe-entities-and-rollback",level:3}],u={toc:s};function p(e){let{components:t,...a}=e;return(0,l.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"removing-metadata-from-datahub"},"Removing Metadata from DataHub"),(0,l.kt)("p",null,"There are a two ways to delete metadata from DataHub:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Delete metadata attached to entities by providing a specific urn or filters that identify a set of entities"),(0,l.kt)("li",{parentName:"ol"},"Delete metadata created by a single ingestion run")),(0,l.kt)("p",null,"To follow this guide you need to use ",(0,l.kt)("a",{parentName:"p",href:"/datahub-project-forked/docs/cli"},"DataHub CLI"),"."),(0,l.kt)("p",null,"Read on to find out how to perform these kinds of deletes."),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Note: Deleting metadata should only be done with care. Always use ",(0,l.kt)("inlineCode",{parentName:"em"},"--dry-run")," to understand what will be deleted before proceeding. Prefer soft-deletes (",(0,l.kt)("inlineCode",{parentName:"em"},"--soft"),") unless you really want to nuke metadata rows. Hard deletes will actually delete rows in the primary store and recovering them will require using backups of the primary metadata store. Make sure you understand the implications of issuing soft-deletes versus hard-deletes before proceeding.")," "),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Deleting metadata using DataHub's CLI and GraphQL API is a simple, systems-level action. If you attempt to delete an Entity with children, such as a Domain, it will not delete those children, you will instead need to delete each child by URN in addition to deleting the parent. ")),(0,l.kt)("h2",{id:"delete-by-urn"},"Delete By Urn"),(0,l.kt)("p",null,"To delete all the data related to a single entity, run"),(0,l.kt)("h3",{id:"soft-delete-the-default"},"Soft Delete (the default)"),(0,l.kt)("p",null,"This sets the ",(0,l.kt)("inlineCode",{parentName:"p"},"Status")," aspect of the entity to ",(0,l.kt)("inlineCode",{parentName:"p"},"Removed"),", which hides the entity and all its aspects from being returned by the UI."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'datahub delete --urn "<my urn>"\n')),(0,l.kt)("p",null,"or"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'datahub delete --urn "<my urn>" --soft\n')),(0,l.kt)("h3",{id:"hard-delete"},"Hard Delete"),(0,l.kt)("p",null,"This physically deletes all rows for all aspects of the entity. This action cannot be undone, so execute this only after you are sure you want to delete all data associated with this entity. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'datahub delete --urn "<my urn>" --hard\n')),(0,l.kt)("p",null,"As of datahub v0.8.35 doing a hard delete by urn will also provide you with a way to remove references to the urn being deleted across the metadata graph. This is important to use if you don't want to have ghost references in your metadata model and want to save space in the graph database.\nFor now, this behaviour must be opted into by a prompt that will appear for you to manually accept or deny."),(0,l.kt)("p",null,"You can optionally add ",(0,l.kt)("inlineCode",{parentName:"p"},"-n")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"--dry-run")," to execute a dry run before issuing the final delete command.\nYou can optionally add ",(0,l.kt)("inlineCode",{parentName:"p"},"-f")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"--force")," to skip confirmations\nYou can optionally add ",(0,l.kt)("inlineCode",{parentName:"p"},"--only-soft-deleted")," flag to remove soft-deleted items only."),(0,l.kt)("p",null," :::note"),(0,l.kt)("p",null,"Make sure you surround your urn with quotes! If you do not include the quotes, your terminal may misinterpret the command._"),(0,l.kt)("p",null,":::"),(0,l.kt)("p",null,"If you wish to hard-delete using a curl request you can use something like below. Replace the URN with the URN that you wish to delete"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'curl "http://localhost:8080/entities?action=delete" -X POST --data \'{"urn": "urn:li:dataset:(urn:li:dataPlatform:hive,fct_users_deleted,PROD)"}\'\n')),(0,l.kt)("h2",{id:"delete-by-filters"},"Delete by filters"),(0,l.kt)("p",null,"_Note: All these commands below support the soft-delete option (",(0,l.kt)("inlineCode",{parentName:"p"},"-s/--soft"),") as well as the dry-run option (",(0,l.kt)("inlineCode",{parentName:"p"},"-n/--dry-run"),"). "),(0,l.kt)("h3",{id:"delete-all-datasets-from-the-snowflake-platform"},"Delete all Datasets from the Snowflake platform"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub delete --entity_type dataset --platform snowflake\n")),(0,l.kt)("h3",{id:"delete-all-containers-for-a-particular-platform"},"Delete all containers for a particular platform"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub delete --entity_type container --platform s3\n")),(0,l.kt)("h3",{id:"delete-all-datasets-in-the-dev-environment"},"Delete all datasets in the DEV environment"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub delete --env DEV --entity_type dataset\n")),(0,l.kt)("h3",{id:"delete-all-pipelines-and-tasks-in-the-dev-environment"},"Delete all Pipelines and Tasks in the DEV environment"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'datahub delete --env DEV --entity_type "dataJob"\ndatahub delete --env DEV --entity_type "dataFlow"\n')),(0,l.kt)("h3",{id:"delete-all-bigquery-datasets-in-the-prod-environment"},"Delete all bigquery datasets in the PROD environment"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub delete --env PROD --entity_type dataset --platform bigquery\n")),(0,l.kt)("h3",{id:"delete-all-looker-dashboards-and-charts"},"Delete all looker dashboards and charts"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub delete --entity_type dashboard --platform looker\ndatahub delete --entity_type chart --platform looker\n")),(0,l.kt)("h3",{id:"delete-all-datasets-that-match-a-query"},"Delete all datasets that match a query"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'datahub delete --entity_type dataset --query "_tmp"\n')),(0,l.kt)("h2",{id:"rollback-ingestion-run"},"Rollback Ingestion Run"),(0,l.kt)("p",null,"The second way to delete metadata is to identify entities (and the aspects affected) by using an ingestion ",(0,l.kt)("inlineCode",{parentName:"p"},"run-id"),". Whenever you run ",(0,l.kt)("inlineCode",{parentName:"p"},"datahub ingest -c ..."),", all the metadata ingested with that run will have the same run id."),(0,l.kt)("p",null,"To view the ids of the most recent set of ingestion batches, execute"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub ingest list-runs\n")),(0,l.kt)("p",null,"That will print out a table of all the runs. Once you have an idea of which run you want to roll back, run"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub ingest show --run-id <run-id>\n")),(0,l.kt)("p",null,"to see more info of the run."),(0,l.kt)("p",null,"Alternately, you can execute a dry-run rollback to achieve the same outcome. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub ingest rollback --dry-run --run-id <run-id>\n")),(0,l.kt)("p",null,"Finally, once you are sure you want to delete this data forever, run"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"datahub ingest rollback --run-id <run-id>\n")),(0,l.kt)("p",null,"to rollback all aspects added with this run and all entities created by this run.\nThis deletes both the versioned and the timeseries aspects associated with these entities."),(0,l.kt)("h3",{id:"unsafe-entities-and-rollback"},"Unsafe Entities and Rollback"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"NOTE:"))," Preservation of unsafe entities has been added in datahub ",(0,l.kt)("inlineCode",{parentName:"p"},"0.8.32"),". Read on to understand what it means and how it works.")),(0,l.kt)("p",null,'In some cases, entities that were initially ingested by a run might have had further modifications to their metadata (e.g. adding terms, tags, or documentation) through the UI or other means. During a roll back of the ingestion that initially created these entities (technically, if the key aspect for these entities are being rolled back), the ingestion process will analyse the metadata graph for aspects that will be left "dangling" and will:'),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Leave these aspects untouched in the database, and soft-delete the entity. A re-ingestion of these entities will result in this additional metadata becoming visible again in the UI, so you don't lose any of your work. "),(0,l.kt)("li",{parentName:"ol"},"The datahub cli will save information about these unsafe entities as a CSV for operators to later review and decide on next steps (keep or remove).")),(0,l.kt)("p",null,"The rollback command will report how many entities have such aspects and save as a CSV the urns of these entities under a rollback reports directory, which defaults to ",(0,l.kt)("inlineCode",{parentName:"p"},"rollback_reports")," under the current directory where the cli is run, and can be configured further using the ",(0,l.kt)("inlineCode",{parentName:"p"},"--reports-dir")," command line arg."),(0,l.kt)("p",null,"The operator can use ",(0,l.kt)("inlineCode",{parentName:"p"},"datahub get --urn <>")," to inspect the aspects that were left behind and either keep them (do nothing) or delete the entity (and its aspects) completely using ",(0,l.kt)("inlineCode",{parentName:"p"},"datahub delete --urn <urn> --hard"),". If the operator wishes to remove all the metadata associated with these unsafe entities, they can re-issue the rollback command with the ",(0,l.kt)("inlineCode",{parentName:"p"},"--nuke")," flag."))}p.isMDXComponent=!0}}]);